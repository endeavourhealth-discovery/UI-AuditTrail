!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/cdk/overlay"),require("@angular/router"),require("keycloak-angular"),require("rxjs"),require("@angular/common/http"),require("@angular/material/snack-bar"),require("@angular/material"),require("@angular/forms"),require("@angular/platform-browser"),require("@angular/material/progress-spinner"),require("@angular/material/card"),require("@angular/material/icon")):"function"==typeof define&&define.amd?define("dds-angular8",["exports","@angular/core","@angular/common","@angular/cdk/overlay","@angular/router","keycloak-angular","rxjs","@angular/common/http","@angular/material/snack-bar","@angular/material","@angular/forms","@angular/platform-browser","@angular/material/progress-spinner","@angular/material/card","@angular/material/icon"],e):e((t=t||self)["dds-angular8"]={},t.ng.core,t.ng.common,t.ng.cdk.overlay,t.ng.router,t.keycloakAngular,t.rxjs,t.ng.common.http,t.ng.material["snack-bar"],t.ng.material,t.ng.forms,t.ng.platformBrowser,t.ng.material["progress-spinner"],t.ng.material.card,t.ng.material.icon)}(this,function(t,e,n,r,o,a,i,s,u,c,l,p,d,m,g){"use strict";var f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function h(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}var v=function(){};var y=function(){function t(){}return t.prototype.ngOnInit=function(){},t.decorators=[{type:e.Component,args:[{selector:"dds-access-denied",template:'<mat-card>\r\n  <mat-card-header>\r\n    <div mat-card-avatar><mat-icon color="warn">block</mat-icon></div>\r\n    <mat-card-title>Access denied!</mat-card-title>\r\n    <mat-card-subtitle>User account does not have access to this module</mat-card-subtitle>\r\n  </mat-card-header>\r\n  <mat-card-content>\r\n    <p>Your user account is not configured for access to this module.  If you believe this is incorrect, please contact your system administrator.</p>\r\n  </mat-card-content>\r\n</mat-card>\r\n',styles:[""]}]}],t.ctorParameters=function(){return[]},t}(),b=function(){function t(t,e,n){this.http=t,this.keycloakService=e,this.menuProvider=n,this.onProjectChange=new i.ReplaySubject(1),this._keycloakUserId=e.getKeycloakInstance().idTokenParsed.sub}return t.prototype.getUserProfile=function(t){var e=this;return void 0===t&&(t=!1),new Promise(function(n,r){e._userProfile&&!t?n(e._userProfile):e.loadUserProfile().subscribe(function(t){return n(e._userProfile=t)},function(t){return r(t)})})},t.prototype.getUserProjects=function(t){var e=this;return void 0===t&&(t=!1),new Promise(function(n,r){e._userProjects&&!t?n(e._userProjects):e.loadUserProjects().subscribe(function(t){e.setUserProjects(t),n(t)},function(t){return r(t)})})},t.prototype.getSelectedProject=function(){return this._selectedProject},t.prototype.setSelectedProject=function(t){this.onProjectChange.next(t),this._selectedProject=t},t.prototype.getUserRegion=function(){return this._userProfile.region},t.prototype.changeDefaultProject=function(t,e){var n=new s.HttpParams;return n=(n=(n=n.append("userId",this._keycloakUserId)).append("defaultProjectId",t)).append("userProjectId",e),this.http.get("api/userManager/setDefaultProject",{params:n,responseType:"text"})},t.prototype.checkRoleAccess=function(t){var e=this;return new Promise(function(n,r){if(null==t||""==t)n(!0);else{var o=!1,a=e.menuProvider.getApplicationTitle();e.getUserProfile().then(function(){e.getUserProjects().then(function(){var r=e._userProfile.organisationProjects.find(function(t){return t.organisation.uuid==e._selectedProject.organisationId});if(null!=r){var i=r.projects.find(function(t){return t.uuid==e._selectedProject.projectId}).applicationPolicyAttributes;if(null!=i){var s=i.filter(function(t){return t.application==a});null!=s&&(o=null!=s.find(function(e){return e.applicationAccessProfileName==t}))}}n(o)},function(t){return r(t)})},function(t){return r(t)})}})},t.prototype.logout=function(){this.keycloakService.logout()},t.prototype.loadUserProfile=function(){var t=new s.HttpParams;return t=t.append("userId",this._keycloakUserId),this.http.get("api/userManager/getUserProfile",{params:t})},t.prototype.loadUserProjects=function(){var t=new s.HttpParams;return t=t.append("userId",this._keycloakUserId),this.http.get("api/userManager/getProjects",{params:t})},t.prototype.setUserProjects=function(t){this._userProjects=t;var e=t.find(function(t){return t.default});null==e&&t.length>0&&(e=t[0]),this.setSelectedProject(e)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:s.HttpClient},{type:a.KeycloakService},{type:v}]},t}();var P=function(){function t(t){this.snackBar=t}return t.prototype.info=function(t){console.info(t),this.snackBar.open(t,null,{duration:3e3,panelClass:"logger-info",horizontalPosition:"right"})},t.prototype.success=function(t){console.log(t),this.snackBar.open(t,null,{duration:3e3,panelClass:"logger-success",horizontalPosition:"right"})},t.prototype.error=function(t){console.error(t),this.snackBar.open(t,null,{duration:3e3,panelClass:"logger-error",horizontalPosition:"right"})},t.prototype.debug=function(t){console.debug(t)},t.prototype.trace=function(t){console.trace(t)},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:u.MatSnackBar}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(u.MatSnackBar))},token:t,providedIn:"root"}),t}();var x=function(t){function n(e,n,r,o){var a=t.call(this,e,n)||this;return a.router=e,a.keycloakAngular=n,a.userManagerService=r,a.log=o,a._unauthorised=!1,a}return function(t,e){function n(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(n,t),n.secureRoutes=function(t){var e=t.config;(e=e.map(function(t){return t.canActivate=[n],t})).push({path:"unauthorised",component:y}),t.resetConfig(e)},n.prototype.isAccessAllowed=function(t,e){var n=this;return new Promise(function(r,o){if(!n.authenticated)return n.keycloakAngular.login().catch(function(t){return n.log.error(t)}),o("Not logged in");e.url.endsWith("unauthorised")||(n._role=t.data.role,n._url=e.url),n.checkRoleAccess(t.data.role).then(function(t){return r(t)},function(t){return o(t)})})},n.prototype.checkRoleAccess=function(t){var e=this;return new Promise(function(n,r){e.userManagerService.checkRoleAccess(t).then(function(t){t?e._unauthorised&&(e._unauthorised=!1,e.router.navigate([e._url])):(e._unauthorised=!0,e.router.navigate(["/unauthorised"])),n(t)},function(t){return r(t)})})},n.prototype.checkCurrentAccess=function(){return this.checkRoleAccess(this._role)},n.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],n.ctorParameters=function(){return[{type:o.Router},{type:a.KeycloakService},{type:b},{type:P}]},n.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new n(e.ɵɵinject(o.Router),e.ɵɵinject(a.KeycloakService),e.ɵɵinject(b),e.ɵɵinject(P))},token:n,providedIn:"root"}),n}(a.KeycloakAuthGuard);var M=function(){function t(t,e,n,r,o,a){this.menuService=t,this.userManagerService=e,this.router=n,this.overlayContainer=r,this.routeGuard=o,this.log=a,this.open=!1,this.pinned=!1,this.pinIcon="radio_button_unchecked",this.title="",this.menuItems=[]}return t.prototype.ngOnInit=function(){var t=this;x.secureRoutes(this.router),this.title=this.menuService.getApplicationTitle(),this.menuItems=this.menuService.getMenuOptions(),this.setMenuOptionAccess(),this.getUserProfile(),this.userManagerService.onProjectChange.subscribe(function(e){return t.onProjectChange(e)},function(e){return t.log.error(e)})},t.prototype.setMenuOptionAccess=function(){var t,e,n=this,r=this.router.config,o=function(t){var e=r.find(function(e){return e.path==t.state});a.routeGuard.checkRoleAccess(e.data.role).then(function(e){return t.access=e},function(t){return n.log.error(t)})},a=this;try{for(var i=h(this.menuItems),s=i.next();!s.done;s=i.next()){o(s.value)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},t.prototype.onProjectChange=function(t){this.currentProject=t,this.routeGuard.checkCurrentAccess(),this.setMenuOptionAccess()},t.prototype.getUserProfile=function(t){var e=this;void 0===t&&(t=!1),this.userManagerService.getUserProfile(t).then(function(n){return e.setUserProfile(n,t)},function(t){return e.log.error(t)})},t.prototype.setUserProfile=function(t,e){var n=this;void 0===e&&(e=!1),this.user=t,this.userManagerService.getUserProjects(e).then(function(t){return n.userProjects=t},function(t){return n.log.error(t)})},t.prototype.expand=function(){this.open=!0},t.prototype.collapse=function(){this.open=!1},t.prototype.togglePin=function(){this.pinned=!this.pinned,this.pinIcon=this.pinned?"radio_button_checked":"radio_button_unchecked"},t.prototype.logout=function(){this.userManagerService.logout()},t.prototype.onSetTheme=function(t){this.overlayContainer.getContainerElement().classList.add(t),this.componentCssClass=t},t.prototype.switchProject=function(t){var e=this,n=this.user.organisationProjects.find(function(e){return e.organisation.uuid==t.organisationId}).projects.find(function(e){return e.uuid==t.projectId}).applicationPolicyAttributes.filter(function(t){return t.application==e.title});t.applicationPolicyAttributes=n,console.log("switching prohjects",t),this.userManagerService.setSelectedProject(t)},t.prototype.setDefault=function(t){var e=this;this.userManagerService.changeDefaultProject(t.id,this.userManagerService.getSelectedProject().id).subscribe(function(t){return e.getUserProfile(!0)},function(t){return e.log.error(t)})},t.decorators=[{type:e.Component,args:[{selector:"app-root",template:'<div class="side-nav" (mouseenter)="expand()" (mouseleave)="collapse()" [class.collapsed]="!(open||pinned)" [class.pinned]="pinned">\r\n  <div class="logo-container">\r\n    <img class="logo">\r\n    <span class="title" *ngIf="open || pinned">DISCOVERY</span>\r\n    <button mat-button class="toggle" *ngIf="open || pinned" (click)="togglePin()">\r\n      <mat-icon>{{pinIcon}}</mat-icon>\r\n    </button>\r\n  </div>\r\n  <div class="nav-user flex-center">\r\n    <img class="avatar" [src]="user?.photo" [class.default-avatar]="user == null || user.photo == null">\r\n    <div class="user-details">\r\n      <h4>{{user?.forename}} {{user?.surname}}</h4>\r\n      <h5>{{user?.email}}</h5>\r\n      <div class="actions flex-center">\r\n        <button mat-button>\r\n          <mat-icon>account_box</mat-icon>\r\n        </button>\r\n        <button mat-button>\r\n          <mat-icon>settings</mat-icon>\r\n        </button>\r\n        <button mat-button (click)="logout()">\r\n          <mat-icon>exit_to_app</mat-icon>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class="nav-entries">\r\n    <button mat-button *ngFor="let item of menuItems" [routerLink]="item.state" [disabled]="!item.access">\r\n      <mat-icon>{{item.icon}}</mat-icon>\r\n      <span *ngIf="open || pinned" [matBadge]="item.badge" matBadgePosition="after" matBadgeColor="accent" matBadgeOverlap="false"> {{item.caption}}</span>\r\n    </button>\r\n  </div>\r\n\r\n</div>\r\n<div class="nav-content" [class.pinned]="pinned">\r\n  <div class="layout-header">\r\n    <mat-toolbar>\r\n      <span class="title">{{title}}</span>\r\n      <span class="toolbar-fill"></span>\r\n\r\n\x3c!--      <button mat-button>\r\n        <mat-icon matBadge="13" matBadgePosition="above after" matBadgeColor="accent">format_list_bulleted</mat-icon>\r\n      </button>--\x3e\r\n\r\n      <button mat-button *ngIf="currentProject" [matMenuTriggerFor]="projects">\r\n        <mat-icon>work</mat-icon> {{currentProject.projectName}} <small>({{currentProject.organisationName}})</small>\r\n      </button>\r\n      <mat-menu #projects="matMenu" xPosition="before">\r\n        <button *ngFor="let item of userProjects" mat-menu-item (click)="switchProject(item)" [ngClass]="{\'mat-flat-button mat-accent\': (item.id==currentProject.id)}">\r\n          <mat-icon (click)="setDefault(item)">{{item.default ? \'star\' : \'star_border\'}}</mat-icon> <span>{{item.projectName}} <small>({{item.organisationName}})</small></span>\r\n        </button>\r\n      </mat-menu>\r\n\r\n\r\n      <button mat-button [matMenuTriggerFor]="menu">\r\n        <img class="avatar" [src]="(user?.photo == null) ? \'avatar.png\' : user?.photo">\r\n        <span class="name">{{user?.forename}} {{user?.surname}}</span>\r\n        <mat-icon>keyboard_arrow_down</mat-icon>\r\n      </button>\r\n\r\n      <mat-menu #menu="matMenu" xPosition="before">\r\n        <button mat-menu-item><mat-icon>account_box</mat-icon>Profile</button>\r\n        <button mat-menu-item [matMenuTriggerFor]="themeMenu"><mat-icon>format_paint</mat-icon>Theme</button>\r\n        <button mat-menu-item><mat-icon>settings</mat-icon>Settings</button>\r\n        <button mat-menu-item (click)="logout()"><mat-icon>exit_to_app</mat-icon>Logout</button>\r\n      </mat-menu>\r\n      <mat-menu #themeMenu="matMenu">\r\n        <button mat-menu-item (click)="onSetTheme(\'default-theme\')">Default</button>\r\n        <button mat-menu-item (click)="onSetTheme(\'dark-theme\')">Dark</button>\r\n        <button mat-menu-item (click)="onSetTheme(\'teal-theme\')">Teal</button>\r\n      </mat-menu>\r\n\r\n    </mat-toolbar>\r\n  </div>\r\n  <div class="layout-body">\r\n    <router-outlet>\r\n      <div *ngIf="user==null" class="flex" fxLayout="row wrap" fxLayout.xs="column" fxLayoutGap="16px grid" fxLayoutAlign="start">\r\n        <div class="flex-center" fxFill fxFlex="100">\r\n          <mat-spinner></mat-spinner>\r\n        </div>\r\n      </div>\r\n    </router-outlet>\r\n  </div>\r\n</div>\r\n',styles:[".side-nav{float:left;position:absolute;height:100%;transition-property:transform,width,min-width,max-width,opacity;transition-duration:150ms;transition-timing-function:ease-in-out;overflow-x:hidden;white-space:nowrap;z-index:100;min-width:280px;max-width:280px}.side-nav.collapsed{min-width:64px;max-width:64px}.logo-container{height:64px;position:relative}.logo-container .title{position:absolute;top:50%;left:48px;transform:translate(0,-50%);font-weight:300}.logo-container .toggle{position:absolute;top:50%;right:8px;width:32px;height:32px;min-width:32px;transform:translate(0,-50%)}.logo-container .toggle .mat-icon{font-size:12px;vertical-align:unset}.logo{transition-property:transform,width,height,padding;transition-duration:150ms;transition-timing-function:ease-in-out;width:24px;height:24px;padding:20px 16px;border-radius:50%}.collapsed .logo{width:40px!important;height:40px!important;padding:12px!important}.mat-button{padding:0}.layout-header{width:100%;height:64px}.layout-header .avatar{width:32px;height:32px}.layout-header .title{padding:16px}.layout-header .name{margin:0 8px 0 10px}.layout-header .mat-toolbar{padding:0}.layout-header .mat-button{height:100%;padding:12px;border-radius:0;border-left:1px solid rgba(0,0,0,.08)}.toolbar-fill{flex:1 1 auto}.user-details{text-align:center;transition-property:transform,opacity;transition-duration:150ms;transition-timing-function:ease-in-out}.collapsed .user-details{opacity:0}.avatar{width:64px;height:64px;border-radius:50%;margin-bottom:0;transition-property:transform,width,height,opacity,margin-bottom;transition-duration:150ms;transition-timing-function:ease-in-out}.collapsed .avatar{width:48px!important;height:48px!important;border-radius:50%;margin-bottom:16px}.nav-content{margin-left:64px;height:100%}.nav-content.pinned{margin-left:280px;height:100%}.nav-entries{padding:18px}.nav-entries button{width:100%;text-align:left;display:flex;font-weight:200}.nav-entries mat-icon{padding-right:16px}.layout-body{padding:16px;height:calc(100% - 96px);overflow-y:auto}.nav-user{padding:8px 0;flex-direction:column}.nav-user button{width:32px;height:32px;min-width:32px}.nav-user .mat-icon{font-size:18px}.nav-user h4,.nav-user h5{margin:4px;font-weight:400}"]}]}],t.ctorParameters=function(){return[{type:v},{type:b},{type:o.Router},{type:r.OverlayContainer},{type:x},{type:P}]},t.propDecorators={componentCssClass:[{type:e.HostBinding,args:["class"]}]},t}();var j=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[p.BrowserModule,n.CommonModule,c.MatSidenavModule,c.MatRadioModule,l.ReactiveFormsModule,c.MatButtonModule,c.MatSlideToggleModule,l.FormsModule,c.MatIconModule,c.MatListModule,o.RouterModule,c.MatMenuModule,c.MatToolbarModule,c.MatBadgeModule,d.MatProgressSpinnerModule],declarations:[M],entryComponents:[M]}]}],t}(),k=function(){};var w=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule,m.MatCardModule,g.MatIconModule],providers:[x],declarations:[y],entryComponents:[y]}]}],t}(),_=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[],imports:[n.CommonModule],providers:[P]}]}],t}(),I=function(){function t(t){this.userManagerService=t}return t.prototype.intercept=function(t,e){var n=this.userManagerService.getSelectedProject();return n&&n.projectId&&(t=t.clone({setHeaders:{userProjectId:n.id}})),e.handle(t)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:b}]},t}();var S=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[n.CommonModule],declarations:[],providers:[b,{provide:s.HTTP_INTERCEPTORS,useClass:I,multi:!0}]}]}],t}(),C=function(){function t(){this.states={}}return t.prototype.get=function(t){return this.states[t]},t.prototype.set=function(t,e){this.states[t]=e},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var A=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[],imports:[n.CommonModule],providers:[C]}]}],t}();t.AbstractMenuProvider=v,t.CanActivateRouteGuard=x,t.CoreModule=A,t.LayoutComponent=M,t.LayoutModule=j,t.LoggerModule=_,t.LoggerService=P,t.MenuOption=k,t.SecurityModule=w,t.StateService=C,t.UserManagerModule=S,t.UserManagerService=b,t.ɵa=y,t.ɵb=I,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=dds-angular8.umd.min.js.map